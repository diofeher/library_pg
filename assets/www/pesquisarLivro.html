<div data-role="page" id="search">
  <div data-role="header">
    <a href="index.html" data-icon="arrow-l">Back</a>
    <h1>Search Products</h1>
  </div>

  <div data-role="content">
    <input type="button" value="Search By Barcode" onclick="searchByBarcode()"></input>
    <ul data-role="listview" data-inset="true" id="searchList"></ul>
  </div>

  <script type="text/javascript">
    var db = window.openDatabase("Database", "1.0", "PhoneGap Demo", 200000);
    function errorCB(err) {
      alert(err.message);
    };

    function successCB() {
      var len = results.rows.length;
      for (var i=0; i<len; i++){
        var item = results.rows.item(i);
      // var str = "";
      // for (prop in item) {
      //  str += prop + " value :" + item[prop] + "\n";
      // }
        $("#searchList").append('<li><a href="mostrarLivro.html?id="'+ item.id +'"><img src="data:image/jpeg;base64,' + item.photo + '"/></a></li>');
      }
    };

    function searchByBarcode() {
      window.plugins.barcodeScanner.scan(function(result) {
        var barCode = result.text;

        var search = function(tx) {
          var query = "SELECT * FROM Livro WHERE barcode='" + barCode + "';";
          alert(query);
          tx.executeSql(query, errorCB, successCB);
        };
        db.transaction(search, errorCB);
      }, function(error) {
          alert("Failed because: " + error);
      });       
    }
  </script>

</div>